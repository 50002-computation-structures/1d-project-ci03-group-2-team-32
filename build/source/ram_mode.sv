/*
    This file was generated automatically by Alchitry Labs 2.0.30-BETA.
    Do not edit this file directly. Instead edit the original Lucid source.
    This is a temporary file and any changes made to it will be destroyed.
*/

module ram_mode #(
        parameter COLUMN_DIMENSION = 16'h10,
        parameter ROW_DIMENSION = 16'h10,
        parameter PIXEL_COUNT = 16'h100,
        parameter BUFFER_SIZE = 11'h400
    ) (
        input wire clk,
        input wire rst,
        output reg [7:0] led,
        output reg [2:0][7:0] io_led,
        output reg [7:0] io_segment,
        output reg [3:0] io_select,
        input wire left_btn,
        input wire right_btn,
        input wire red_btn,
        input wire blue_btn,
        input wire green_btn,
        input wire [31:0] player_pos_x_out,
        input wire [31:0] player_pos_y_out,
        input wire [31:0] player_bullet_x_out,
        input wire [31:0] player_bullet_y_out,
        input wire bullet_active_out,
        input wire check_boundary_out,
        input wire bullet_slow_clk_out,
        input wire [31:0] bullet_color_out,
        output reg data
    );
    localparam ENCODING_AMOUNT = 3'h4;
    localparam logic [3:0][23:0] LEDCOLOR = {{24'hf0f0f, 24'h30000, 24'h300, 24'h0}};
    localparam logic [3:0][23:0] BULLETCOLOR = {{24'h30000, 24'h300, 24'h3, 24'h0}};
    localparam _MP_SIZE_1542325243 = $clog2(PIXEL_COUNT);
    localparam _MP_COLUMN_DIMENSION_1542325243 = COLUMN_DIMENSION;
    logic [(_MP_SIZE_1542325243)-1:0] M_index_reverser_input_address;
    logic [(_MP_SIZE_1542325243)-1:0] M_index_reverser_output_address;
    
    index_reverser #(
        .SIZE(_MP_SIZE_1542325243),
        .COLUMN_DIMENSION(_MP_COLUMN_DIMENSION_1542325243)
    ) index_reverser (
        .input_address(M_index_reverser_input_address),
        .output_address(M_index_reverser_output_address)
    );
    
    
    localparam _MP_RISE_37659849 = 1'h1;
    localparam _MP_FALL_37659849 = 1'h0;
    logic M_bullet_slow_clk_edge_in;
    logic M_bullet_slow_clk_edge_out;
    
    edge_detector #(
        .RISE(_MP_RISE_37659849),
        .FALL(_MP_FALL_37659849)
    ) bullet_slow_clk_edge (
        .clk(clk),
        .in(M_bullet_slow_clk_edge_in),
        .out(M_bullet_slow_clk_edge_out)
    );
    
    
    localparam _MP_RISE_1454481772 = 1'h0;
    localparam _MP_FALL_1454481772 = 1'h1;
    logic M_left_btn_edge_in;
    logic M_left_btn_edge_out;
    
    edge_detector #(
        .RISE(_MP_RISE_1454481772),
        .FALL(_MP_FALL_1454481772)
    ) left_btn_edge (
        .clk(clk),
        .in(M_left_btn_edge_in),
        .out(M_left_btn_edge_out)
    );
    
    
    localparam _MP_RISE_2092544944 = 1'h0;
    localparam _MP_FALL_2092544944 = 1'h1;
    logic M_right_btn_edge_in;
    logic M_right_btn_edge_out;
    
    edge_detector #(
        .RISE(_MP_RISE_2092544944),
        .FALL(_MP_FALL_2092544944)
    ) right_btn_edge (
        .clk(clk),
        .in(M_right_btn_edge_in),
        .out(M_right_btn_edge_out)
    );
    
    
    localparam _MP_ROW_DIMENSION_1087604005 = ROW_DIMENSION;
    localparam _MP_COLUMN_DIMENSION_1087604005 = COLUMN_DIMENSION;
    localparam _MP_ENCODING_AMOUNT_1087604005 = 3'h4;
    logic M_ram_update;
    logic [($clog2(_MP_COLUMN_DIMENSION_1087604005))-1:0] M_ram_player_x_pos;
    logic [($clog2(_MP_ROW_DIMENSION_1087604005))-1:0] M_ram_player_y_pos;
    logic [($clog2(_MP_COLUMN_DIMENSION_1087604005))-1:0] M_ram_bullet_x;
    logic [($clog2(_MP_ROW_DIMENSION_1087604005))-1:0] M_ram_bullet_y;
    logic M_ram_bullet_active;
    logic [1:0] M_ram_bullet_color;
    logic [($clog2((5'h10)'(_MP_ROW_DIMENSION_1087604005 * _MP_COLUMN_DIMENSION_1087604005)))-1:0] M_ram_address;
    logic [1:0] M_ram_out_encoding;
    logic [1:0] M_ram_bullet_color_out;
    logic M_ram_is_bullet;
    logic M_ram_ready;
    logic [($clog2((5'h10)'(_MP_ROW_DIMENSION_1087604005 * _MP_COLUMN_DIMENSION_1087604005)))-1:0] M_ram_debug_address_pointer;
    logic [2:0] M_ram_debug_data;
    
    data_ram #(
        .ROW_DIMENSION(_MP_ROW_DIMENSION_1087604005),
        .COLUMN_DIMENSION(_MP_COLUMN_DIMENSION_1087604005),
        .ENCODING_AMOUNT(_MP_ENCODING_AMOUNT_1087604005)
    ) ram (
        .clk(clk),
        .rst(rst),
        .update(M_ram_update),
        .player_x_pos(M_ram_player_x_pos),
        .player_y_pos(M_ram_player_y_pos),
        .bullet_x(M_ram_bullet_x),
        .bullet_y(M_ram_bullet_y),
        .bullet_active(M_ram_bullet_active),
        .bullet_color(M_ram_bullet_color),
        .address(M_ram_address),
        .out_encoding(M_ram_out_encoding),
        .bullet_color_out(M_ram_bullet_color_out),
        .is_bullet(M_ram_is_bullet),
        .ready(M_ram_ready),
        .debug_address_pointer(M_ram_debug_address_pointer),
        .debug_data(M_ram_debug_data)
    );
    
    
    localparam _MP_PIXEL_COUNT_105193300 = PIXEL_COUNT;
    logic M_driver_update;
    logic [23:0] M_driver_color;
    logic M_driver_clear;
    logic [($clog2(_MP_PIXEL_COUNT_105193300))-1:0] M_driver_pixel_address;
    logic M_driver_data;
    logic M_driver_next_pixel;
    logic M_driver_reset;
    logic M_driver_done;
    
    ws2812b_driver #(
        .PIXEL_COUNT(_MP_PIXEL_COUNT_105193300)
    ) driver (
        .clk(clk),
        .rst(rst),
        .update(M_driver_update),
        .color(M_driver_color),
        .clear(M_driver_clear),
        .pixel_address(M_driver_pixel_address),
        .data(M_driver_data),
        .next_pixel(M_driver_next_pixel),
        .reset(M_driver_reset),
        .done(M_driver_done)
    );
    
    
    always @* begin
        led = 8'h0;
        io_segment = 8'hff;
        io_select = 4'hf;
        data = 1'h0;
        M_ram_address = 1'h0;
        M_ram_update = 1'h0;
        M_driver_update = 1'h0;
        M_driver_clear = 1'h0;
        M_left_btn_edge_in = left_btn;
        M_right_btn_edge_in = right_btn;
        M_bullet_slow_clk_edge_in = bullet_slow_clk_out;
        M_bullet_slow_clk_edge_in = bullet_slow_clk_out;
        if (M_left_btn_edge_out | M_right_btn_edge_out | (bullet_active_out & M_bullet_slow_clk_edge_out)) begin
            M_ram_update = 1'h1;
        end
        M_ram_player_x_pos = player_pos_x_out;
        M_ram_player_y_pos = player_pos_y_out;
        M_ram_bullet_x = player_bullet_x_out;
        M_ram_bullet_y = player_bullet_y_out;
        M_ram_bullet_active = bullet_active_out;
        M_ram_bullet_color = bullet_color_out[1'h1:1'h0];
        M_index_reverser_input_address = M_driver_pixel_address;
        M_driver_update = 1'h1;
        M_ram_address = M_index_reverser_output_address;
        if (M_ram_is_bullet) begin
            M_driver_color = BULLETCOLOR[M_ram_bullet_color_out];
        end else begin
            M_driver_color = LEDCOLOR[M_ram_out_encoding];
        end
        data = M_driver_data;
        io_led[1'h0] = bullet_color_out[1'h1:1'h0];
        io_led[1'h1] = player_bullet_y_out;
        io_led[2'h2][1'h0] = bullet_active_out;
        io_led[2'h2][1'h1] = check_boundary_out;
        io_led[2'h2][3'h7:2'h2] = 1'h0;
        led[3'h7:3'h5] = M_ram_debug_data;
    end
    
    
endmodule